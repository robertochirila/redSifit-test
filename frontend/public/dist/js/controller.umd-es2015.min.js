!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=37)}([,function(e,t,n){var r=n(11),o=n(6);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(30);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},,,,function(e,t,n){(function(t){var r,o=n(16),i=n(25),u=n(26),s=Array.prototype.slice,a={};r=void 0!==t&&t.console?t.console:"undefined"!=typeof window&&window.console?window.console:{};for(var c=[[function(){},"log"],[function(){r.log.apply(r,arguments)},"info"],[function(){r.log.apply(r,arguments)},"warn"],[function(){r.warn.apply(r,arguments)},"error"],[function(e){a[e]=u()},"time"],[function(e){var t=a[e];if(!t)throw new Error("No such label: "+e);var n=u()-t;r.log(e+": "+n+"ms")},"timeEnd"],[function(){var e=new Error;e.name="Trace",e.message=o.format.apply(null,arguments),r.error(e.stack)},"trace"],[function(e){r.log(o.inspect(e)+"\n")},"dir"],[function(e){if(!e){var t=s.call(arguments,1);i.ok(!1,o.format.apply(null,t))}},"assert"]],f=0;f<c.length;f++){var l=c[f],p=l[0],d=l[1];r[d]||(r[d]=p)}e.exports=r}).call(this,n(12))},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){(function(e,n){(function(t){"use strict";var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e},u=function(){function e(){r(this,e),this._proxy=self,this._registerMessageListeners()}return i(e,[{key:"_registerMessageListeners",value:function(){var e=this;this._proxy&&(this._proxy.onmessage=function(t){var n=t.data.method;e["_"+n]&&e["_"+n](t.data.params)})}},{key:"_emailStats",value:function(e){this.onstats&&this.onstats(e.name,e.value)}},{key:"_getThreadRowDisplayInfo",value:function(e){var t=this,n={};e.tris.forEach(function(r){void 0!==r.value&&void 0!==r.value.list&&t.loadThreadListView&&(n[r.key]=t.loadThreadListView(r.value.list,e.supportedTemplates))}),this._proxy.postMessage({method:"getThreadRowDisplayInfoCallback",params:n})}}]),e}(),s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(){function e(){s(this,e),this._observers=[]}return a(e,[{key:"subscribe",value:function(e,t){this._op("_sub",e,t)}},{key:"unsubscribe",value:function(e,t){this._op("_unsub",e,t)}},{key:"unsubscribeAll",value:function(e){this._observers[e]&&delete this._observers[e]}},{key:"publish",value:function(e,t){this._op("_pub",e,t)}},{key:"_op",value:function(e,t,n){var r=this;Array.isArray(t)?t.forEach(function(t){r[e](t,n)}):this[e](t,n)}},{key:"_sub",value:function(e,t){this._observers[e]||(this._observers[e]=[]),t&&-1===this._observers[e].indexOf(t)&&this._observers[e].push(t)}},{key:"_unsub",value:function(e,t){if(this._observers[e]){var n=this._observers[e].indexOf(t);~n&&this._observers[e].splice(n,1)}}},{key:"_pub",value:function(e,t){if(this._observers[e])for(var n=this._observers[e].length-1;n>=0;n--)this._observers[e][n](t)}}]),e}(),f=function(){function t(){r(this,t),this._resizeHandler=null,this._proxy=parent,this.controller=new c,this._registerMessageListeners()}return i(t,[{key:"publish",value:function(e,t){this._proxy.postMessage({method:"notifyController",params:{topic:e,value:t}},"*")}},{key:"notifyClient",value:function(e,t){this._proxy.postMessage({method:"notifyClient",params:{topic:e,value:t}},"*")}},{key:"showOAuthPopup",value:function(e){var t=e.provider,n=e.options,r={provider:t,options:void 0===n?null:n};this.notifyClient("showOAuthPopup",r)}},{key:"removeOAuthIdentity",value:function(e){var t={provider:e.provider};this.notifyClient("showOAuthRemovePopup",t)}},{key:"signup",value:function(){this.notifyClient("signup",{})}},{key:"login",value:function(){this.notifyClient("login",{})}},{key:"logout",value:function(){this.notifyClient("logout",{})}},{key:"navigate",value:function(e){var t=e.href,n=e.openInNewTab,r={href:t,openInNewTab:void 0!==n&&n};this.notifyClient("navigate",r)}},{key:"_registerMessageListeners",value:function(){var t=this;window.addEventListener("message",function(n){var r=n.data.method,o=n.data.params;"notifyView"===r?t.controller.publish(o.topic,o.value):t[r]?t[r](o):e.warn("[SiftView]: method not implemented: ",r)},!1)}}]),t}();function l(e,t){return e(t={exports:{}},t.exports),t.exports}var p=l(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(r){return"function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?e.exports=n=function(e){return t(e)}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},n(r)}e.exports=n}),d=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},h=function(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?d(e):t},y=l(function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(n)}e.exports=t}),g=l(function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(n,r)}e.exports=t}),v=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)},b=function(e){function t(e){var n;return r(this,t),(n=h(this,y(t).call(this)))._proxy=e,n}return v(t,c),i(t,[{key:"goto",value:function(e){this._postMessage("goto",e)}},{key:"close",value:function(){this._postMessage("close")}},{key:"_postMessage",value:function(e,t){this._proxy.postMessage({method:"notifyClient",params:{topic:e,value:t}})}}]),t}(),m=function(e){function t(){var e;return r(this,t),(e=h(this,y(t).call(this)))._storage=null,e}return v(t,c),i(t,[{key:"init",value:function(e){this._storage=e}},{key:"get",value:function(e){return this._storage.get(e)}},{key:"getIndexKeys",value:function(e){return this._storage.getIndexKeys(e)}},{key:"getIndex",value:function(e){return this._storage.getIndex(e)}},{key:"getWithIndex",value:function(e){return this._storage.getWithIndex(e)}},{key:"getAllKeys",value:function(e){return this._storage.getAllKeys(e)}},{key:"getAll",value:function(e){return this._storage.getAll(e)}},{key:"getUser",value:function(e){return this._storage.getUser(e)}},{key:"putUser",value:function(e){return this._storage.putUser(e)}},{key:"delUser",value:function(e){return this._storage.delUser(e)}}]),t}(),w="undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{};function k(e,t){return e(t={exports:{}},t.exports),t.exports}var x,_=k(function(t){var n,r;n=w,r=function(){var t=function(){},n="undefined",r=["trace","debug","info","warn","error"];function o(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(e,n){for(var o=0;o<r.length;o++){var i=r[o];this[i]=o<e?t:this.methodFactory(i,e,n)}this.log=this.debug}function u(r,u,s){return function(r){return"debug"===r&&(r="log"),typeof e!==n&&(void 0!==e[r]?o(e,r):void 0!==e.log?o(e,"log"):t)}(r)||function(t,r,o){return function(){typeof e!==n&&(i.call(this,r,o),this[t].apply(this,arguments))}}.apply(this,arguments)}function s(t,o,s){var a,c=this,f="loglevel";function l(){var e;if(typeof window!==n){try{e=window.localStorage[f]}catch(e){}if(typeof e===n)try{var t=window.document.cookie,r=t.indexOf(encodeURIComponent(f)+"=");-1!==r&&(e=/^([^;]+)/.exec(t.slice(r))[1])}catch(e){}return void 0===c.levels[e]&&(e=void 0),e}}t&&(f+=":"+t),c.name=t,c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=s||u,c.getLevel=function(){return a},c.setLevel=function(o,u){if("string"==typeof o&&void 0!==c.levels[o.toUpperCase()]&&(o=c.levels[o.toUpperCase()]),!("number"==typeof o&&o>=0&&o<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+o;if(a=o,!1!==u&&function(e){var t=(r[e]||"silent").toUpperCase();if(typeof window!==n){try{return void(window.localStorage[f]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(f)+"="+t+";"}catch(e){}}}(o),i.call(c,o,t),typeof e===n&&o<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(e){l()||c.setLevel(e,!1)},c.enableAll=function(e){c.setLevel(c.levels.TRACE,e)},c.disableAll=function(e){c.setLevel(c.levels.SILENT,e)};var p=l();null==p&&(p=null==o?"WARN":o),c.setLevel(p,!1)}var a=new s,c={};a.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=c[e];return t||(t=c[e]=new s(e,a.getLevel(),a.methodFactory)),t};var f=typeof window!==n?window.log:void 0;return a.noConflict=function(){return typeof window!==n&&window.log===a&&(window.log=f),a},a.getLoggers=function(){return c},a},t.exports?t.exports=r():n.log=r()}),S=Object.prototype.toString,O=function(e){switch(S.call(e)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}return null===e?"null":void 0===e?"undefined":e!=e?"nan":e&&1===e.nodeType?"element":typeof(e=e.valueOf?e.valueOf():Object.prototype.valueOf.apply(e))},j=Object.prototype.toString,E=function(e){var t;return"[object Object]"===j.call(e)&&(null===(t=Object.getPrototypeOf(e))||t===Object.getPrototypeOf({}))},I=k(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=w.IDBKeyRange||w.webkitIDBKeyRange;if(e instanceof t)return e;if(null==e)return null;if(!(0,r.default)(e))return t.only(e);var n=Object.keys(e).sort();if(1===n.length){var o=n[0],i=e[o];switch(o){case"eq":return t.only(i);case"gt":return t.lowerBound(i,!0);case"lt":return t.upperBound(i,!0);case"gte":return t.lowerBound(i);case"lte":return t.upperBound(i);default:throw new TypeError('"'+o+'" is not valid key')}}else{var u=e[n[0]],s=e[n[1]],a=n.join("-");switch(a){case"gt-lt":return t.bound(u,s,!0,!0);case"gt-lte":return t.bound(u,s,!0,!1);case"gte-lt":return t.bound(u,s,!1,!0);case"gte-lte":return t.bound(u,s,!1,!1);default:throw new TypeError('"'+a+'" are conflicted keys')}}};var n,r=(n=E)&&n.__esModule?n:{default:n};e.exports=t.default});(x=I)&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")&&x.default;var T=P;function P(e,t){this.db=null,this.name=e,this.indexes={},this.opts=t,this.key=t.key||t.keyPath||void 0,this.increment=t.increment||t.autoIncretement||void 0}P.prototype.index=function(e){return this.indexes[e]},P.prototype.put=function(e,t,n){var r=this.name,o=this.key;o&&("object"==O(e)?(n=t,t=e,e=null):t[o]=e),this.db.transaction("readwrite",[r],function(i,u){if(i)return n(i);var s=u.objectStore(r),a=o?s.put(t):s.put(t,e);u.onerror=u.onabort=a.onerror=n,u.oncomplete=function(){n(null,a.result)}})},P.prototype.get=function(e,t){var n=this.name;this.db.transaction("readonly",[n],function(r,o){if(r)return t(r);var i=o.objectStore(n).get(e);i.onerror=t,i.onsuccess=function(e){t(null,e.target.result)}})},P.prototype.del=function(e,t){var n=this.name;this.db.transaction("readwrite",[n],function(r,o){if(r)return t(r);var i=o.objectStore(n).delete(e);o.onerror=o.onabort=i.onerror=t,o.oncomplete=function(){t()}})},P.prototype.count=function(e){var t=this.name;this.db.transaction("readonly",[t],function(n,r){if(n)return e(n);var o=r.objectStore(t).count();o.onerror=e,o.onsuccess=function(t){e(null,t.target.result)}})},P.prototype.clear=function(e){var t=this.name;this.db.transaction("readwrite",[t],function(n,r){if(n)return e(n);var o=r.objectStore(t).clear();r.onerror=r.onabort=o.onerror=e,r.oncomplete=function(){e()}})},P.prototype.batch=function(e,t){var n=this.name,r=this.key,o=Object.keys(e);this.db.transaction("readwrite",[n],function(i,u){if(i)return t(i);var s=u.objectStore(n),a=0;u.onerror=u.onabort=t,u.oncomplete=function(){t()},function n(){if(a>=o.length)return;var i=o[a];var u=e[i];var c;null===u?c=s.delete(i):r?(u[r]||(u[r]=i),c=s.put(u)):c=s.put(u,i);c.onerror=t;c.onsuccess=n;a+=1}()})},P.prototype.all=function(e){var t=[];this.cursor({iterator:function(e){t.push(e.value),e.continue()}},function(n){n?e(n):e(null,t)})},P.prototype.cursor=function(e,t){var n=this.name;this.db.transaction("readonly",[n],function(r,o){if(r)return t(r);var i=(e.index?o.objectStore(n).index(e.index):o.objectStore(n)).openCursor(I(e.range));i.onerror=t,i.onsuccess=function(n){var r=n.target.result;r?e.iterator(r):t()}})};var C=A;function A(e,t,n,r){this.store=e,this.name=t,this.field=n,this.opts=r,this.multi=r.multi||r.multiEntry||!1,this.unique=r.unique||!1}A.prototype.get=function(e,t){var n=[],r=this.unique,o={range:e,iterator:function(e){n.push(e.value),e.continue()}};this.cursor(o,function(e){if(e)return t(e);t(null,r?n[0]:n)})},A.prototype.count=function(e,t){var n=this.store.name,r=this.name;this.store.db.transaction("readonly",[n],function(o,i){if(o)return t(o);var u=i.objectStore(n).index(r).count(I(e));u.onerror=t,u.onsuccess=function(e){t(null,e.target.result)}})},A.prototype.cursor=function(e,t){e.index=this.name,this.store.cursor(e,t)};var D=q;function q(){if(!(this instanceof q))return new q;this._stores={},this._current={},this._versions={}}q.prototype.version=function(e){if("number"!=O(e)||e<1||e<this.getVersion())throw new TypeError("not valid version");return this._current={version:e,store:null},this._versions[e]={stores:[],dropStores:[],indexes:[],dropIndexes:[],version:e},this},q.prototype.addStore=function(e,t){if("string"!=O(e))throw new TypeError("`name` is required");if(this._stores[e])throw new TypeError("store is already defined");var n=new T(e,t||{});return this._stores[e]=n,this._versions[this.getVersion()].stores.push(n),this._current.store=n,this},q.prototype.dropStore=function(e){if("string"!=O(e))throw new TypeError("`name` is required");var t=this._stores[e];if(!t)throw new TypeError("store is not defined");return delete this._stores[e],this._versions[this.getVersion()].dropStores.push(t),this},q.prototype.addIndex=function(e,t,n){if("string"!=O(e))throw new TypeError("`name` is required");if("string"!=O(t)&&"array"!=O(t))throw new TypeError("`field` is required");var r=this._current.store;if(r.indexes[e])throw new TypeError("index is already defined");var o=new C(r,e,t,n||{});return r.indexes[e]=o,this._versions[this.getVersion()].indexes.push(o),this},q.prototype.dropIndex=function(e){if("string"!=O(e))throw new TypeError("`name` is required");var t=this._current.store.indexes[e];if(!t)throw new TypeError("index is not defined");return delete this._current.store.indexes[e],this._versions[this.getVersion()].dropIndexes.push(t),this},q.prototype.getStore=function(e){if("string"!=O(e))throw new TypeError("`name` is required");if(!this._stores[e])throw new TypeError("store is not defined");return this._current.store=this._stores[e],this},q.prototype.getVersion=function(){return this._current.version},q.prototype.callback=function(){var e=Object.keys(this._versions).map(function(e){return this._versions[e]},this).sort(function(e,t){return e.version-t.version});return function(t){var n=t.target.result,r=t.target.transaction;e.forEach(function(e){t.oldVersion>=e.version||(e.stores.forEach(function(e){var t={};void 0!==e.key&&(t.keyPath=e.key),void 0!==e.increment&&(t.autoIncrement=e.increment),n.createObjectStore(e.name,t)}),e.dropStores.forEach(function(e){n.deleteObjectStore(e.name)}),e.indexes.forEach(function(e){r.objectStore(e.store.name).createIndex(e.name,e.field,{unique:e.unique,multiEntry:e.multi})}),e.dropIndexes.forEach(function(e){r.objectStore(e.store.name).deleteIndex(e.name)}))})}};var G=k(function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);if("string"!=O(e))throw new TypeError("`name` required");if(!(t instanceof D))throw new TypeError("not valid schema");this.name=e,this.status="close",this.origin=null,this.stores=t._stores,this.version=t.getVersion(),this.onupgradeneeded=t.callback(),Object.keys(this.stores).forEach(function(e){this.stores[e].db=this},this)}function r(){return w._indexedDB||w.indexedDB||w.msIndexedDB||w.mozIndexedDB||w.webkitIndexedDB}(t=e.exports=n).schema=D,t.cmp=function(){return r().cmp.apply(r(),arguments)},t.Treo=n,t.Schema=D,t.Store=T,t.Index=C,n.prototype.use=function(e){return e(this,t),this},n.prototype.drop=function(e){var t=this.name;this.close(function(n){if(n)return e(n);var o=r().deleteDatabase(t);o.onerror=e,o.onsuccess=function(){e()}})},n.prototype.close=function(e){if("close"==this.status)return e();this.getInstance(function(t,n){if(t)return e(t);n.origin=null,n.status="close",n.close(),e()})},n.prototype.store=function(e){return this.stores[e]},n.prototype.getInstance=function(e){if("open"==this.status)return e(null,this.origin);if("opening"==this.status)return this.queue.push(e);this.status="opening",this.queue=[e];var t=this,n=r().open(this.name,this.version);n.onupgradeneeded=this.onupgradeneeded,n.onerror=n.onblocked=function(e){t.status="error",t.queue.forEach(function(t){t(e)}),delete t.queue},n.onsuccess=function(e){t.origin=e.target.result,t.status="open",t.origin.onversionchange=function(){t.close(function(){})},t.queue.forEach(function(e){e(null,t.origin)}),delete t.queue}},n.prototype.transaction=function(e,t,n){this.getInstance(function(r,o){r?n(r):n(null,o.transaction(t,e))})}}),M=(G.schema,G.cmp,G.Treo,G.Schema,G.Store,G.Index,_.getLogger("RSStorage:operations"));M.setLevel("warn");var R=["_email.id","_email.tid"],L=[[{name:"_id.list",indexes:["sift.guid"]},{name:"_tid.list",indexes:["sift.guid"]}],[{name:"_email.id",indexes:["sift.guid"]},{name:"_email.tid",indexes:["sift.guid"]},{name:"_id.list",drop:!0},{name:"_tid.list",drop:!0}]],U=[{name:"events",indexes:["value.sift.guid"]},{name:"admin"}],V=[{name:"tour"},{name:"spm"},{name:"auth"}];function N(e,t,n){if(M.trace("[opDel]: ",t,n),!t.bucket)return Promise.reject("[opDel]: params.bucket undefined");if(!t.keys||0===t.keys.length)return M.trace("[opDel]: params.keys undefined"),Promise.resolve();if(-1!==R.indexOf(t.bucket)){var r=t.keys.map(function(e){return n+"/"+e});return Z(e.msg,{bucket:t.bucket,keys:r})}return Z(e.db,t)}function z(e,t,n){if(M.trace("[opGet]: ",t),!t.bucket)return Promise.reject("[opGet]: params.bucket undefined");if(!t.keys)return Promise.reject("[opGet]: param.keys undefined");if(0===t.keys.length)return Promise.resolve([]);if(-1!==R.indexOf(t.bucket)){var r=t.keys.map(function(e){return n+"/"+e});return X(e.msg,{bucket:t.bucket,keys:r}).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})})}return X(e.db,t)}function F(e,t,n){return M.trace("[opGetAll]: ",t,n),t.bucket?-1!==R.indexOf(t.bucket)?ee(e.msg,{bucket:t.bucket,index:"sift.guid",range:n},!0).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})}):ee(e.db,t,!0):Promise.reject("[opGetAll]: params.bucket undefined")}function B(e,t,n){return M.trace("[opGetAllKeys]: ",t,n),t.bucket?-1!==R.indexOf(t.bucket)?ee(e.msg,{bucket:t.bucket,index:"sift.guid",range:n},!1).then(function(e){return e.map(function(e){return e.key.split("/")[1]})}):ee(e.db,t,!1):Promise.reject("[opGetAllKeys]: params.bucket undefined")}function K(e,t,n){return M.trace("[opGetIndex]: ",t,n),t.bucket?-1!==R.indexOf(t.bucket)?ee(e.msg,{bucket:t.bucket,index:"sift.guid",range:n},!0).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})}):t.index?ee(e.db,t,!0):Promise.reject("[opGetIndex]:params.index undefined"):Promise.reject("[opGetIndex]:params.bucket undefined")}function W(e,t,n){return M.trace("[opGetIndexKeys]: ",t,n),t.bucket?-1!==R.indexOf(t.bucket)?ee(e.msg,{bucket:t.bucket,index:"sift.guid",range:n},!1).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})}):t.index?ee(e.db,t,!1):Promise.reject("[opGetIndexKeys]: params.index undefined"):Promise.reject("[opGetIndexKeys]: params.bucket undefined")}function H(e,t,n){if(M.trace("[opGetWithIndex]: ",t,n),!t.bucket)return Promise.reject("[opGetWithIndex]:params.bucket undefined");if(!t.keys)return Promise.reject("[opGetWithIndex]:params.keys undefined");if(-1!==R.indexOf(t.bucket)){var r=t.keys.map(function(e){return n+"/"+e});return Q(e.msg,{bucket:t.bucket,keys:r,index:"sift.guid",range:n}).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})})}return t.index?t.range?Q(e.db,t):Promise.reject("[opGetWithIndex]:params.range undefined"):Promise.reject("[opGetWithIndex]:params.index undefined")}function J(e,t,n,r){M.trace("[opPut]: ",t,n,r);var o=e.db;if(!t.bucket)return Promise.reject("[opPut]: params.bucket undefined");if(!t.kvs||0===t.kvs.length)return M.warn("[opPut]: params.kvs undefined"),Promise.resolve();var i=t.kvs;if(n||(i=i.map(function(e){return{key:e.key,value:{value:e.value}}})),-1!==R.indexOf(t.bucket)){o=e.msg;i=i.map(function(e){return{key:r+"/"+e.key,value:e.value}})}return function(e,t){return M.trace("[_batchPut]: ",t),new Promise(function(n,r){var o=t.kvs.length;e.transaction("readwrite",[t.bucket],function(e,i){if(e)return r(e);var u=i.objectStore(t.bucket),s=0;i.onerror=i.onabort=r,i.oncomplete=function(){n()},function e(){var n;s>=o||(M.trace("[_batchPut: put: ",t.kvs[s]),(n=u.put(t.kvs[s].value,t.kvs[s].key)).onerror=r,n.onsuccess=e,s+=1)}()})})}(o,{bucket:t.bucket,kvs:i})}function $(e,t){M.trace("[_getTreoSchema]: ",e,t);var n=G.schema().version(1);return e.forEach(function(e){t&&-1!==R.indexOf(e.name)||(n=e.keypath?n.addStore(e.name,{key:e.keypath}):n.addStore(e.name),e.indexes&&e.indexes.forEach(function(e){n=n.addIndex(e,"twoI."+e,{unique:!1})}))}),n}function Y(e,t){M.trace("[_getVersionedTreoSchema]: ",e,t);var n=G.schema();return e.forEach(function(e,r){n=n.version(r+1),e.forEach(function(e){t&&-1!==R.indexOf(e.name)||(e.drop?(M.trace("[_getVersionedTreoSchema]: dropping store: ",e.name),n=n.dropStore(e.name)):n=e.keypath?n.addStore(e.name,{key:e.keypath}):n.addStore(e.name),e.indexes&&e.indexes.forEach(function(t){e.drop?(M.trace("[_getVersionedTreoSchema]: dropping store/index: "+e.name+"/"+t),n=n.dropIndex(t)):n=n.addIndex(t,t,{unique:!1})}))})}),n}function Z(e,t){return M.trace("[_batchDelete]: ",t),new Promise(function(n,r){e.transaction("readwrite",[t.bucket],function(e,o){if(e)return r(e);var i=o.objectStore(t.bucket),u=0;o.onerror=o.onabort=r,o.oncomplete=function(){n()},function e(){if(!(u>=t.keys.length)){var n,o=t.keys[u];(n=i.delete(o)).onerror=r,n.onsuccess=e,u+=1}}()})})}function Q(e,t){return M.trace("[_getWithIndexRange]: ",t),new Promise(function(n,r){var o=e.store(t.bucket),i=[],u=0,s=function(e){M.trace("[_getWithIndexRange: result: ",i),e?r(e):n(i)};t.keys.forEach(function(e){i.push({key:e,value:void 0})}),o.cursor({index:t.index,range:t.range,iterator:function(e){var n=t.keys.indexOf(e.primaryKey);if(-1!==n&&(M.trace("[found key: ",e.primaryKey),i[n].value=e.value.value,u++),u===t.keys.length)return s();e.continue()}},s)})}function X(e,t){return M.trace("[_findIn]: ",t),new Promise(function(n,r){var o=e.store(t.bucket),i=[],u=0,s=function(e){M.trace("[findIn]: result: ",i),e?r(e):n(i)},a=t.keys.slice();a=a.sort(G.cmp),M.trace("[findIn: sorted keys: ",a),t.keys.forEach(function(e){i.push({key:e,value:void 0})}),o.cursor({iterator:function(e){if(M.trace("[_findIn]: iterator: ",e),e.key>a[u]){for(M.trace("[_findIn]: cursor ahead: ",e.key,a[u]);e.key>a[u]&&u<a.length;)u+=1,M.trace("[_findIn]: moving to next key: ",e.key,a[u]);if(u>a.length)return M.trace("[_findIn]: exhausted keys. done."),s()}e.key===a[u]?(M.trace("[_findIn]: found key: ",e.key,e.value),i[t.keys.indexOf(a[u])]={key:e.key,value:e.value.value},(u+=1)<a.length?e.continue(a[u]):s()):(M.trace("[_findIn]: continuing to next key: ",a[u]),u<a.length?e.continue(a[u]):s())}},s)})}function ee(e,t,n){return M.trace("[_getAll]: ",t,n),new Promise(function(r,o){var i=[],u=[],s=e.store(t.bucket),a={iterator:function(e){var r={key:e.primaryKey};M.trace("[_getAll]: cursor",e),n&&(r.value=e.value.value),t.index&&(r.index=e.key),i.push(r),u.push(e.primaryKey),e.continue()}};t.index&&(a.index=t.index),t.range&&(a.range=t.range),s.cursor(a,function(e){e?o(e):t.index||t.range||n?(M.trace("[_getAll]: resolving: ",i),r(i)):(M.trace("[_getAll]: resolving: ",u),r(u))})})}var te=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ne=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),re=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},oe=new WeakMap,ie=new WeakMap,ue=function(){function e(t,n){if(te(this,e),this._logger=_.getLogger("RSStorage"),this._logger.setLevel(n||"warn"),!t.accountGuid)throw new Error("[Storage]: dbInfo.accountGuid undefined");oe.set(this,t.siftGuid),ie.set(this,function(e){M.trace("[opCreateDb]: ",e);var t={};switch(e.type){case"MSG":t.msg=G("rs_msg_db-"+e.accountGuid,Y(L));break;case"SIFT":if(!e.siftGuid)throw new Error("[opCreateDb]: dbInfo.siftGuid undefined");M.trace("[opCreateDb]: creating SIFT db");var n=$(e.schema,!0);n=n.addStore("_user.default").addStore("_redsift").addStore("_org"),t.db=G(e.siftGuid+"-"+e.accountGuid,n),t.msg=G("rs_msg_db-"+e.accountGuid,Y(L));break;case"SYNC":M.trace("[opCreateDb]: creating SYNC db"),t.db=G("rs_sync_log-"+e.accountGuid,$(U));break;case"CLIENT":t.db=G("rs_client_db-"+e.clientName,$(V));break;default:throw new Error("[opCreateDb]: unsupported db type: "+e.type)}return t}(t))}return ne(e,[{key:"get",value:function(e){return this._logger.trace("[Storage::get]: ",e),z(ie.get(this),e,oe.get(this))}},{key:"getAll",value:function(e){return this._logger.trace("[Storage::getAll]: ",e),F(ie.get(this),e,oe.get(this))}},{key:"getAllKeys",value:function(e){return this._logger.trace("[Storage::getAllKeys]: ",e),B(ie.get(this),e,oe.get(this))}},{key:"getIndex",value:function(e){return this._logger.trace("[Storage::getIndex]: ",e),K(ie.get(this),e,oe.get(this))}},{key:"getIndexKeys",value:function(e){return this._logger.trace("[Storage::getIndexKeys]: ",e),W(ie.get(this),e,oe.get(this))}},{key:"getWithIndex",value:function(e){return this._logger.trace("[Storage::getWithIndex]: ",e),H(ie.get(this),e,oe.get(this))}},{key:"delUser",value:function(e){return e.bucket="_user.default",this._logger.trace("[Storage::delUser]: ",e),N(ie.get(this),e,oe.get(this))}},{key:"getUser",value:function(e){return e.bucket="_user.default",this._logger.trace("[Storage::getUser]: ",e),z(ie.get(this),e,oe.get(this))}},{key:"putUser",value:function(e){return e.bucket="_user.default",this._logger.trace("[Storage::putUser]: ",e),e.kvs&&0!==e.kvs.length?J(ie.get(this),e,!1,oe.get(this)):Promise.reject("[Storage::putUser]: params.kvs undefined")}},{key:"close",value:function(e){!function(e,t){M.trace("[opClose]"),t||(t=function(){}),e.db.close(t)}(ie.get(this),e)}}]),e}(),se=(function(e){function t(e,n){return te(this,t),re(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(t,ue),ne(t,[{key:"get",value:function(e,t){return this._logger.trace("[InternalStorage::get]: ",e,t),z(ie.get(this),e,t||oe.get(this))}},{key:"getAll",value:function(e,t){return this._logger.trace("[InternalStorage::getAll]: ",e,t),F(ie.get(this),e,t||oe.get(this))}},{key:"getAllKeys",value:function(e,t){return this._logger.trace("[InternalStorage::getAllKeys]: ",e,t),B(ie.get(this),e,t||oe.get(this))}},{key:"getIndex",value:function(e,t){return this._logger.trace("[InternalStorage::getIndex]: ",e,t),K(ie.get(this),e,t||oe.get(this))}},{key:"getIndexKeys",value:function(e,t){return this._logger.trace("[InternalStorage::getIndexKeys]: ",e,t),W(ie.get(this),e,t||oe.get(this))}},{key:"getWithIndex",value:function(e,t){return this._logger.trace("[InternalStorage::getWithIndex]: ",e,t),H(ie.get(this),e,t||oe.get(this))}},{key:"cursor",value:function(e,t){this._logger.trace("[InternalStorage::cursor]: ",e),function(e,t,n){if(M.trace("[opCursor]",t),!t.bucket)throw new Error("[opCursor: params.bucket undefined");e.store(t.bucket).cursor({iterator:t.iterator},n)}(ie.get(this).db,e,t)}},{key:"del",value:function(e,t){return this._logger.trace("[InternalStorage::del]: ",e,t),N(ie.get(this),e,t||oe.get(this))}},{key:"deleteDatabase",value:function(){return this._logger.trace("[InternalStorage::deleteDatabase]"),e=ie.get(this).db,M.trace("[opDeleteDatabase]"),new Promise(function(t,n){e.drop(function(e){e?n(e):t()})});var e}},{key:"getDbs",value:function(){return ie.get(this)}},{key:"put",value:function(e,t,n){return this._logger.trace("[InternalStorage::put]: ",e,t,n),J(ie.get(this),e,t,n||oe.get(this))}}])}(),function(){function t(){r(this,t),this._proxy=self,this.view=new c,this.emailclient=new b(self),this._registerMessageListeners()}return i(t,[{key:"publish",value:function(e,t){this._proxy.postMessage({method:"notifyView",params:{topic:e,value:t}})}},{key:"_registerMessageListeners",value:function(){var e=this;this._proxy&&(this._proxy.onmessage=function(t){var n=t.data.method;e["_"+n]&&e["_"+n](t.data.params)})}},{key:"_init",value:function(e){this.storage=new m,this.storage.init(new ue({type:"SIFT",siftGuid:e.siftGuid,accountGuid:e.accountGuid,schema:e.dbSchema})),this._guid=e.siftGuid,this._account=e.accountGuid,this._proxy.postMessage({method:"initCallback",result:e})}},{key:"_terminate",value:function(){this._proxy&&this._proxy.close()}},{key:"_postCallback",value:function(e,t){this._proxy.postMessage({method:"loadViewCallback",params:{user:{guid:this._account},sift:{guid:this._guid},type:e.type,sizeClass:e.sizeClass,result:t}})}},{key:"_loadView",value:function(t){var n=this;if(this.loadView){var r=this.loadView({sizeClass:t.sizeClass,type:t.type,params:t.data});r.data&&"function"==typeof r.data.then?(r.html&&this._postCallback(t,{html:r.html}),r.data.then(function(e){n._postCallback(t,{html:r.html,data:e})}).catch(function(t){e.error("[SiftController::loadView]: promise rejected: ",t)})):this._postCallback(t,r)}else e.error("[SiftController::_loadView]: Sift controller must implement the loadView method")}},{key:"_storageUpdated",value:function(e){var t=this;this.storage.publish("*",e),e.forEach(function(e){t.storage.publish(e,[e])})}},{key:"_notifyController",value:function(e){this.view.publish(e.topic,e.value)}},{key:"_emailComposer",value:function(e){this.emailclient.publish(e.topic,e.value)}}]),t}());function ae(e,t){var n=function(){e.call(this),this.init&&"function"==typeof this.init&&this.init()};return n.prototype=Object.create(e.prototype),n.constructor=n,Object.keys(t).forEach(function(e){n.prototype[e]=t[e]}),new n}t.EmailClientController=u,t.SiftController=se,t.SiftStorage=m,t.SiftView=f,t.registerSiftView=function(t){e.log("[Redsift::registerSiftView]: registered")},t.createSiftView=function(e){return ae(f,e)},t.createSiftController=function(e){return ae(se,e)},t.registerSiftController=function(t){e.log("[Redsift::registerSiftController]: registered")},t.createEmailClientController=function(e){return ae(u,e)},t.registerEmailClientController=function(t){e.log("[Redsift::registerEmailClientController]: registered")},Object.defineProperty(t,"__esModule",{value:!0})})(t)}).call(this,n(10),n(12))},,function(e,t,n){(function(e,r){var o=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},i=/%[sdj%]/g;t.format=function(e){if(!b(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,u=String(e).replace(i,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),s=r[n];n<o;s=r[++n])g(s)||!k(s)?u+=" "+s:u+=" "+a(s);return u},t.deprecate=function(n,o){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,o).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(o);e.traceDeprecation?r.trace(o):r.error(o),i=!0}return n.apply(this,arguments)}};var u,s={};function a(e,n){var r={seen:[],stylize:f};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),y(n)?r.showHidden=n:n&&t._extend(r,n),m(r.showHidden)&&(r.showHidden=!1),m(r.depth)&&(r.depth=2),m(r.colors)&&(r.colors=!1),m(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),l(r,e,r.depth)}function c(e,t){var n=a.styles[t];return n?"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m":e}function f(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&S(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,e);return b(o)||(o=l(e,o,r)),o}var i=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(b(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(v(t))return e.stylize(""+t,"number");if(y(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(e,n);if(i)return i;var u=Object.keys(n),s=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(u);if(e.showHidden&&(u=Object.getOwnPropertyNames(n)),_(n)&&(u.indexOf("message")>=0||u.indexOf("description")>=0))return p(n);if(0===u.length){if(S(n)){var a=n.name?": "+n.name:"";return e.stylize("[Function"+a+"]","special")}if(w(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(x(n))return e.stylize(Date.prototype.toString.call(n),"date");if(_(n))return p(n)}var c,f="",k=!1,O=["{","}"];(h(n)&&(k=!0,O=["[","]"]),S(n))&&(f=" [Function"+(n.name?": "+n.name:"")+"]");return w(n)&&(f=" "+RegExp.prototype.toString.call(n)),x(n)&&(f=" "+Date.prototype.toUTCString.call(n)),_(n)&&(f=" "+p(n)),0!==u.length||k&&0!=n.length?r<0?w(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=k?function(e,t,n,r,o){for(var i=[],u=0,s=t.length;u<s;++u)T(t,String(u))?i.push(d(e,t,n,r,String(u),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(d(e,t,n,r,o,!0))}),i}(e,n,r,s,u):u.map(function(t){return d(e,n,r,s,t,k)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,f,O)):O[0]+f+O[1]}function p(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,o,i){var u,s,a;if((a=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?s=a.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):a.set&&(s=e.stylize("[Setter]","special")),T(r,o)||(u="["+o+"]"),s||(e.seen.indexOf(a.value)<0?(s=g(n)?l(e,a.value,null):l(e,a.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),m(u)){if(i&&o.match(/^\d+$/))return s;(u=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(u=u.substr(1,u.length-2),u=e.stylize(u,"name")):(u=u.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),u=e.stylize(u,"string"))}return u+": "+s}function h(e){return Array.isArray(e)}function y(e){return"boolean"==typeof e}function g(e){return null===e}function v(e){return"number"==typeof e}function b(e){return"string"==typeof e}function m(e){return void 0===e}function w(e){return k(e)&&"[object RegExp]"===O(e)}function k(e){return"object"==typeof e&&null!==e}function x(e){return k(e)&&"[object Date]"===O(e)}function _(e){return k(e)&&("[object Error]"===O(e)||e instanceof Error)}function S(e){return"function"==typeof e}function O(e){return Object.prototype.toString.call(e)}function j(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(m(u)&&(u=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!s[n])if(new RegExp("\\b"+n+"\\b","i").test(u)){var o=e.pid;s[n]=function(){var e=t.format.apply(t,arguments);r.error("%s %d: %s",n,o,e)}}else s[n]=function(){};return s[n]},t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=h,t.isBoolean=y,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=v,t.isString=b,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=m,t.isRegExp=w,t.isObject=k,t.isDate=x,t.isError=_,t.isFunction=S,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(23);var E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(){var e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(":");return[e.getDate(),E[e.getMonth()],t].join(" ")}function T(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){r.log("%s - %s",I(),t.format.apply(t,arguments))},t.inherits=n(24),t._extend=function(e,t){if(!t||!k(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var P="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function C(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(P&&e[P]){var t;if("function"!=typeof(t=e[P]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise(function(e,r){t=e,n=r}),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push(function(e,r){e?n(e):t(r)});try{e.apply(this,o)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),P&&Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,o(e))},t.promisify.custom=P,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var o=n.pop();if("function"!=typeof o)throw new TypeError("The last argument must be of type Function");var i=this,u=function(){return o.apply(i,arguments)};t.apply(this,n).then(function(t){e.nextTick(u,null,t)},function(t){e.nextTick(C,t,u)})}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,o(t)),n}}).call(this,n(19),n(10))},function(e,t,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function u(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,s,a=u(e),c=1;c<arguments.length;c++){for(var f in n=Object(arguments[c]))o.call(n,f)&&(a[f]=n[f]);if(r){s=r(n);for(var l=0;l<s.length;l++)i.call(n,s[l])&&(a[s[l]]=n[s[l]])}}return a}},function(e,t,n){var r=n(27),o=n(28),i=n(29);e.exports=function(e,t){return r(e)||o(e,t)||i()}},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:u}catch(e){r=u}}();var a,c=[],f=!1,l=-1;function p(){f&&a&&(f=!1,a.length?c=a.concat(c):l=-1,c.length&&d())}function d(){if(!f){var e=s(p);f=!0;for(var t=c.length;t;){for(a=c,c=[];++l<t;)a&&a[l].run();l=-1,t=c.length}a=null,f=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===u||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function y(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||f||s(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},,,,function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";(function(t){var r=n(17);
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function o(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0}function i(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var u=n(16),s=Object.prototype.hasOwnProperty,a=Array.prototype.slice,c="foo"===function(){}.name;function f(e){return Object.prototype.toString.call(e)}function l(e){return!i(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var p=e.exports=b,d=/\s*function\s+([^\(\s]*)\s*/;function h(e){if(u.isFunction(e)){if(c)return e.name;var t=e.toString().match(d);return t&&t[1]}}function y(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function g(e){if(c||!u.isFunction(e))return u.inspect(e);var t=h(e);return"[Function"+(t?": "+t:"")+"]"}function v(e,t,n,r,o){throw new p.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:o})}function b(e,t){e||v(e,!0,t,"==",p.ok)}function m(e,t,n,r){if(e===t)return!0;if(i(e)&&i(t))return 0===o(e,t);if(u.isDate(e)&&u.isDate(t))return e.getTime()===t.getTime();if(u.isRegExp(e)&&u.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(l(e)&&l(t)&&f(e)===f(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===o(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return!1;var s=(r=r||{actual:[],expected:[]}).actual.indexOf(e);return-1!==s&&s===r.expected.indexOf(t)||(r.actual.push(e),r.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(u.isPrimitive(e)||u.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=w(e),i=w(t);if(o&&!i||!o&&i)return!1;if(o)return e=a.call(e),t=a.call(t),m(e,t,n);var s,c,f=_(e),l=_(t);if(f.length!==l.length)return!1;for(f.sort(),l.sort(),c=f.length-1;c>=0;c--)if(f[c]!==l[c])return!1;for(c=f.length-1;c>=0;c--)if(s=f[c],!m(e[s],t[s],n,r))return!1;return!0}(e,t,n,r))}return n?e===t:e==t}function w(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function k(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function x(e,t,n,r){var o;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),o=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!o&&v(o,n,"Missing expected exception"+r);var i="string"==typeof r,s=!e&&o&&!n;if((!e&&u.isError(o)&&i&&k(o,n)||s)&&v(o,n,"Got unwanted exception"+r),e&&o&&n&&!k(o,n)||!e&&o)throw o}p.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return y(g(e.actual),128)+" "+e.operator+" "+y(g(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||v;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,o=h(t),i=r.indexOf("\n"+o);if(i>=0){var u=r.indexOf("\n",i+1);r=r.substring(u+1)}this.stack=r}}},u.inherits(p.AssertionError,Error),p.fail=v,p.ok=b,p.equal=function(e,t,n){e!=t&&v(e,t,n,"==",p.equal)},p.notEqual=function(e,t,n){e==t&&v(e,t,n,"!=",p.notEqual)},p.deepEqual=function(e,t,n){m(e,t,!1)||v(e,t,n,"deepEqual",p.deepEqual)},p.deepStrictEqual=function(e,t,n){m(e,t,!0)||v(e,t,n,"deepStrictEqual",p.deepStrictEqual)},p.notDeepEqual=function(e,t,n){m(e,t,!1)&&v(e,t,n,"notDeepEqual",p.notDeepEqual)},p.notDeepStrictEqual=function e(t,n,r){m(t,n,!0)&&v(t,n,r,"notDeepStrictEqual",e)},p.strictEqual=function(e,t,n){e!==t&&v(e,t,n,"===",p.strictEqual)},p.notStrictEqual=function(e,t,n){e===t&&v(e,t,n,"!==",p.notStrictEqual)},p.throws=function(e,t,n){x(!0,e,t,n)},p.doesNotThrow=function(e,t,n){x(!1,e,t,n)},p.ifError=function(e){if(e)throw e},p.strict=r(function e(t,n){t||v(t,!0,n,"==",e)},p,{equal:p.strictEqual,deepEqual:p.deepStrictEqual,notEqual:p.notStrictEqual,notDeepEqual:p.notDeepStrictEqual}),p.strict.strict=p.strict;var _=Object.keys||function(e){var t=[];for(var n in e)s.call(e,n)&&t.push(n);return t}}).call(this,n(12))},function(e,t){e.exports=function(){return(new Date).getTime()}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(r=(u=s.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},,,,,,,function(e,t,n){e.exports=n(38)},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"default",function(){return k});var r=n(18),o=n.n(r),i=n(2),u=n.n(i),s=n(3),a=n.n(s),c=n(1),f=n.n(c),l=n(4),p=n.n(l),d=n(6),h=n.n(d),y=n(5),g=n.n(y),v=n(13),b=n.n(v),m=n(14),w=["counts","messages","display"],k=function(t){function n(){var t;return u()(this,n),t=f()(this,p()(n).call(this)),b()(h()(t),"onStorageUpdate",function(n){return e.log("email-sift-web: onStorageUpdate: ",n),t.getData().then(function(e){t.publish("dataUpdate",e)})}),t}return g()(n,t),a()(n,[{key:"loadView",value:function(t){var n=this;switch(e.log("email-sift: loadView",t),w.forEach(function(e){return n.storage.subscribe([e],n.onStorageUpdate)}),t.type){case"summary":return{html:"summary.html",data:this.getData()};default:e.error("email-sift-web: unknown Sift type: ",t.type)}}},{key:"getData",value:function(){return Promise.all([this.getCounts(),this.getMessages(),this.getHeaders()]).then(function(e){var t=o()(e,3);return{counts:t[0],messages:t[1],headers:t[2]}})}},{key:"getCounts",value:function(){return this.storage.get({bucket:"counts",keys:["MESSAGES","WORDS"]}).then(function(e){return{messageTotal:e[0].value||0,wordTotal:e[1].value||0,wpmTotal:((e[1].value||0)/(e[0].value||1)).toFixed(2)}})}},{key:"getMessages",value:function(){return this.storage.getAll({bucket:"messages"}).then(function(e){return e.map(function(e){var t=e.value;return JSON.parse(t)})||[]})}},{key:"getHeaders",value:function(){return this.storage.getAll({bucket:"display"}).then(function(e){return e.map(function(e){var t=e.value;return JSON.parse(t)})||[]})}}]),n}(m.SiftController);Object(m.registerSiftController)(new k)}.call(this,n(10))}]);
//# sourceMappingURL=controller.umd-es2015.min.js.map